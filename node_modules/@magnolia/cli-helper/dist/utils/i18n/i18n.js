import path from 'path';
import fs from 'fs-extra';
import { fileURLToPath } from 'url';
import i18next from 'i18next';
import Backend from 'i18next-fs-backend';
import { EventEmitter } from 'events';
EventEmitter.defaultMaxListeners = 30;
const __dirname = path.dirname(fileURLToPath(import.meta.url));
export function initI18n(pluginName, namespace = 'translation', localesPath = undefined) {
    const lng = 'en';
    if (!localesPath) {
        localesPath = path.join(__dirname, `../../locales/`);
    }
    const localesLngPath = path.join(localesPath, lng);
    const namespaces = fs
        .readdirSync(localesLngPath)
        .filter((file) => file.endsWith('.json'))
        .map((file) => file.replace('.json', ''));
    if (!namespaces.includes(namespace)) {
        // eslint-disable-next-line no-console
        console.warn(`${pluginName}: Requested translation file "${namespace}" not found at "${localesLngPath}".\n`);
        if (namespaces.length > 0) {
            // eslint-disable-next-line no-console
            console.warn(`Using "${namespaces[0]}" instead.\n`);
        }
        namespace = namespaces[0];
    }
    const newI18nInstance = i18next.createInstance();
    newI18nInstance.use(Backend).init({
        joinArrays: '\n',
        lng: lng,
        fallbackLng: 'en',
        ns: namespaces,
        defaultNS: namespace,
        initImmediate: false,
        interpolation: {
            escapeValue: false,
        },
        backend: {
            loadPath: path.join(localesPath, '/{{lng}}/{{ns}}.json'),
        },
    });
    return newI18nInstance;
}
export const i18nInstance = initI18n('plugins-helper');
