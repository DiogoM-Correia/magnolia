import { PluginTemplate } from '@magnolia/cli-plugin-template';
import { Option } from 'commander';
import { createRequire } from 'module';
import {Logger} from "winston";
const requireFn = createRequire(import.meta.url);
const pkg = requireFn('./package.json');

// Defining interface for plugin options
interface PluginOptions {
  name: string;
}

// The logger is available for external access.
// It serves the function of collecting various operational details (info, warnings, errors, etc.), directing them into a log file.
// Utilizing this logger is advised for consistent log documentation. In the event of operational issues, the resulting log files
// provide a resource for analysis and problem resolution.
export let logger: Logger;

export default class {{className}} extends PluginTemplate {
  // Basic plugin information fetched from package.json
  name = pkg.name; // you can use custom value: e.g., "my-custom-plugin"
  version = pkg.version;
  description = pkg.description;

  // CLI options definition for the plugin. Each option added here should correspond to an entry in the PluginOptions interface.
  options = [
    new Option('-n, --name <name>', 'Say hello to <name>')
  ]

  constructor() {
    super();
  }

  // The 'init' method is called by the CLI to initialize a logger
  async init(winstonLogger: Logger) {
    logger = winstonLogger;
  }

  // The 'start' method is called when the plugin is initiated by the CLI with options provided by the user
  async start(options: PluginOptions) {
    logger?.info("Plugin started");
    logger?.info(JSON.stringify(options));

    // If the user has provided the 'name' option, the 'sayHello' method is called
    if (options.name) {
      this.sayHello(options.name)
    } else {
      // Warning is logged if no name was provided in options
      logger?.warn("No --name <name> passed in options");
    }
  }

  // The 'stop' method is called, upon a SIGINT signal indicating that the plugin should clean up and shut down
  async stop() {
    logger?.info("Plugin stopped");
  }

  // Function to log a greeting; this showcases an example action performed by the plugin
  sayHello(name: string) {
    logger?.info(`Hello ${name}`);
  }
}
