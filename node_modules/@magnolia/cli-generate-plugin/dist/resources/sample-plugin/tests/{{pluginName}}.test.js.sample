import {{className}} from "../dist/{{pluginName}}.js";
import { afterEach, beforeEach, describe, expect, jest, test } from "@jest/globals";

describe('{{pluginName}} plugin test', () => {
    let pluginInstance, mockLogger

    beforeEach(() => {
        mockLogger = { warn: jest.fn(), info: jest.fn() };
        pluginInstance = new {{className}}();
        pluginInstance.init(mockLogger);
    });

    afterEach(() => {
        jest.restoreAllMocks();
    });

    test('Should greet user with correct name', async () => {
        let options = { name: "John" }
        await expect(pluginInstance.start(options)).resolves.toBeUndefined();
        expect(mockLogger.warn).not.toHaveBeenCalled();
        expect(mockLogger.info).toHaveBeenNthCalledWith(1, "Plugin started");
        expect(mockLogger.info).toHaveBeenNthCalledWith(2, JSON.stringify(options));
        expect(mockLogger.info).toHaveBeenNthCalledWith(3, "Hello John");
    })

    test('Should warn when no name is passed', async () => {
        let options = { name: undefined }
        await expect(pluginInstance.start(options)).resolves.toBeUndefined();
        expect(mockLogger.warn).toHaveBeenCalled();
        expect(mockLogger.warn).toHaveBeenCalledWith("No --name <name> passed in options");
    })
})
