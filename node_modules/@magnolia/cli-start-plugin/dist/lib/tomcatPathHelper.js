var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {
    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
import path from 'path';
import { helper } from './helper.js';
import { i18nInstance, logger } from '../start-plugin.js';
import { promptForDirOrFile } from '@magnolia/cli-helper/prompt';
const context = 'tp';
const getTomcatPath = (options, pluginArgs) => __awaiter(void 0, void 0, void 0, function* () {
    let tomcatPath;
    let updated = true;
    let tomcatPathMsg;
    if ((options === null || options === void 0 ? void 0 : options.tomcat) !== undefined && typeof (options === null || options === void 0 ? void 0 : options.tomcat) !== 'boolean') {
        tomcatPath = yield helper.validatePath(path.resolve(helper.getCwd(), options.tomcat), context, 'option');
        tomcatPathMsg = 'info-using-option-tomcatPath';
    }
    else if ((options === null || options === void 0 ? void 0 : options.tomcat) !== undefined &&
        typeof (options === null || options === void 0 ? void 0 : options.tomcat) === 'boolean') {
        logger === null || logger === void 0 ? void 0 : logger.info(i18nInstance.t('info-select-tomcat-dir'));
        tomcatPath = (yield promptForDirOrFile());
    }
    else if ((pluginArgs === null || pluginArgs === void 0 ? void 0 : pluginArgs.tomcatPath) !== undefined) {
        tomcatPath = yield helper.validatePath(path.resolve(process.cwd(), pluginArgs === null || pluginArgs === void 0 ? void 0 : pluginArgs.tomcatPath), context, 'plugin');
        tomcatPathMsg = 'info-using-plugin-tomcatPath';
        if (tomcatPath)
            updated = false;
    }
    else {
        tomcatPath = yield helper.validatePath(path.resolve(process.cwd(), helper.getCwd()), context);
        tomcatPathMsg = 'info-using-cwd-tomcatPath';
    }
    if (!tomcatPath) {
        logger === null || logger === void 0 ? void 0 : logger.info(i18nInstance.t('info-select-tomcat-dir'));
        tomcatPath = (yield promptForDirOrFile());
    }
    else if (tomcatPathMsg !== undefined) {
        logger === null || logger === void 0 ? void 0 : logger.info(i18nInstance.t(tomcatPathMsg, { path: tomcatPath }));
    }
    tomcatPath = helper.locateTomcatDirectory(helper.getAbsolutePath(tomcatPath));
    if (!tomcatPath) {
        while (tomcatPath === undefined) {
            logger === null || logger === void 0 ? void 0 : logger.warn(i18nInstance.t('warn-tomcat-dir-not-found'));
            logger === null || logger === void 0 ? void 0 : logger.info(i18nInstance.t('info-select-tomcat-dir'));
            tomcatPath = (yield promptForDirOrFile());
            tomcatPath = helper.locateTomcatDirectory(path.resolve(process.cwd(), tomcatPath));
        }
        updated = true;
    }
    tomcatPath = helper.getAbsolutePath(tomcatPath);
    return { tomcatPath, updated };
});
export const tpHelper = {
    getTomcatPath,
};
